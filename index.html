<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>QIEB - BMI Card Generator</title>
    
    
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
<style>
    /* --- Root Variables & Base Styles --- */
    :root {
      /* Colors based on reference image */
      --primary-blue: #020952; 
      --secondary-blue: #6ec6ff; 
      --orange: #ff9500; 
      --card-info-bg: #f7faff; 
      --photo-placeholder-bg: linear-gradient(135deg, #E0ECF7, #F0F6FC); 

      /* Text Colors */
      --text-dark: #1a1a1a; 
      --text-body: #333333; 
      --text-light: #ffffff; 
      --text-muted: #52607a; 
      --text-soft-white: #cccccc; 
      
      /* General UI */
      --bg-light: #f3f6fb; 
      --card-bg: #ffffff; 
      
      /* Border Radii */
      --radius-lg: 18px; 
      --radius-md: 12px; 
      --radius-sm: 8px; 
      
      /* Shadows */
      --shadow-panel: 0 4px 12px rgba(0, 0, 0, 0.1); 
      --shadow-card: 0 8px 25px rgba(0, 0, 0, 0.15); 
      --shadow-header: 0 2px 8px rgba(0,0,0,0.2); 
      --shadow-photo: 0 2px 8px rgba(0,0,0,0.1); 
      --shadow-bmi-inset: inset 0 -3px 8px rgba(0, 0, 0, 0.05); 
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif; 
      background: var(--bg-light);
      margin: 0;
      padding: 15px; 
      display: flex;
      align-items: flex-start; 
      justify-content: center;
      color: var(--text-body);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-y: auto; 
    }
    
    /* Global layout for app (controls and card) */
    .app-container {
      width: 100%;
      max-width: 1100px; 
      display: grid;
      grid-template-columns: 1fr; 
      gap: 20px; 
    }

    .panel {
      background: var(--card-bg);
      border-radius: var(--radius-md);
      padding: 20px;
      box-shadow: var(--shadow-panel);
    }

    /* --- PREVIEW CONTAINER (Responsive on Screen) --- */
    .panel-preview {
        width: 100%;
        max-width: 700px; 
        margin: 0 auto; 
        aspect-ratio: 1/1;
        
        /* New: Use Flexbox to center the fixed-size card */
        display: flex;
        align-items: center;
        justify-content: center;
        
        /* New: Background to prevent the area from looking blank */
        background: #e9eef7; 
        border-radius: var(--radius-lg);
        
        overflow: hidden; 
        position: relative; 
        box-shadow: var(--shadow-card); 
        order: -1; 
    }
    
    /* --- OUTPUT CARD (Fixed Size for Download Consistency) --- */
    .final-card-output {
        /* Fixed, high-resolution dimensions for guaranteed consistency */
        width: 600px; 
        height: 600px; 
        
        /* New: Allows the card to be scaled down by JavaScript */
        transform-origin: center center; 
        
        background: var(--card-bg); 
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column; 
        font-family: 'Inter', sans-serif;
        box-shadow: var(--shadow-card); 
        
        /* Must be absolute to center itself inside the flex container before scaling */
        position: absolute; 
    }


    /* --- Card Internal Layout (Fixed PX values) --- */
    
    /* Header Bar */
    .card-header {
      background: var(--primary-blue);
      color: var(--text-light);
      padding: 15px 20px; 
      border-top-left-radius: var(--radius-lg); 
      border-top-right-radius: var(--radius-lg);
      margin-bottom: 12px; 
      display: flex;
      align-items: center;
      gap: 15px; 
      box-shadow: var(--shadow-header); 
    }
    .logo-slot {
      width: 60px; height: 60px; min-width: 60px; 
      border-radius: 50%; background: white; 
      display: flex; align-items: center; justify-content: center;
      border: 1px solid #e0e0e0; overflow: hidden;
      font-size: 11px; color: var(--text-muted); font-weight: bold;
      flex-shrink: 0;
    }
    .logo-slot img { width: 100%; height: 100%; object-fit: contain; }
    .school-text { flex: 1; line-height: 1.2; } 
    .school-name { font-size: 16px; font-weight: 900; letter-spacing: 0.2px; }
    .school-sub { font-size: 11px; color: #e0e0e0; margin-top: 3px; }

    /* Main Card Body */
    .card-body {
      display: flex; gap: 20px; flex: 1; 
      padding: 0 20px 15px 20px; 
      overflow: hidden; 
    }
    
    /* Photo Section */
    .card-photo {
      width: 170px; height: 170px; flex-shrink: 0; 
    }
    .photo-wrap {
      width: 100%; height: 100%;
      border-radius: var(--radius-md); 
      background: var(--photo-placeholder-bg); 
      display: flex; align-items: center; justify-content: center;
      overflow: hidden; border: 3px solid #f0f0f0; 
      box-shadow: var(--shadow-photo); 
      background-size: cover; background-position: center;
    }
    #photoPlaceholder {
      font-size: 18px; color: #999; font-weight: 800;
    }
    
    /* Student Info Section */
    .card-info {
      flex: 1; display: flex; flex-direction: column; 
      padding-top: 5px; 
    }

    /* Info Grid */
    .info-grid {
      display: grid; grid-template-columns: 80px 1fr; 
      gap: 6px 10px; margin-bottom: 15px; 
      font-size: 14px;
    }
    .info-grid .label { 
      font-weight: normal; color: var(--text-body); 
      font-size: 14px; text-align: right; white-space: nowrap; 
    }
    .info-grid .value { 
      font-weight: 700; color: var(--text-dark); 
      font-size: 14px; overflow: hidden; text-overflow: ellipsis; 
      white-space: nowrap; 
    }

    /* BMI Result Area */
    .card-result {
      background: var(--card-info-bg); border-radius: var(--radius-md);
      padding: 12px 15px; margin-top: auto; 
      box-shadow: var(--shadow-bmi-inset); 
    }
    .bmi-large { font-size: 38px; font-weight: 900; color: var(--primary-blue); line-height: 1; }
    .bmi-status { font-size: 16px; font-weight: 700; color: #666; margin-top: 2px; }
    .card-result > div:first-child > div:last-child {
        text-align: right; font-size: 10px; color: #999; line-height: 1.2;
    }
    
    /* Advice Section */
    .card-advice {
      margin-top: 15px; padding: 12px 15px; 
      border-left: 4px solid var(--secondary-blue); background: #fdfdfd; 
      border-radius: var(--radius-sm); font-size: 13px; color: var(--text-body);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05); 
    }
    .card-advice strong { color: var(--text-dark); }
    
    /* BMI Week Bar */
    .bmic-bar {
      text-align: center; background-color: var(--orange); 
      color: var(--text-light); padding: 10px 20px; 
      border-radius: var(--radius-md); margin: 15px 20px 10px 20px; 
      font-size: 12px; font-weight: 900; text-transform: uppercase;
      letter-spacing: 0.2px; white-space: nowrap; 
    }

    /* Footer Bar */
    .card-footer {
      font-size: 10px; color: var(--text-soft-white); 
      text-align: center; background: var(--primary-blue); 
      padding: 10px 20px; 
      border-bottom-left-radius: var(--radius-lg); 
      border-bottom-right-radius: var(--radius-lg);
      margin-top: auto; letter-spacing: 0.1px;
      white-space: nowrap; 
    }

    /* --- Controls & Form Styles (General Responsiveness) --- */
    .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; }
    video { width: 100%; border-radius: var(--radius-sm); background: #000; margin-bottom: 12px; }
    .camera-wrap { border: 1px solid #e0e0e0; border-radius: var(--radius-md); padding: 12px; display: flex; flex-direction: column; align-items: center; }
    
    /* Desktop Layout */
    @media (min-width: 980px) {
      .app-container { 
        grid-template-columns: 380px 1fr; 
        gap: 30px; 
      }
      .panel-preview { 
        order: 0; 
      }
    }
      
  </style>
</head>
<body class="app-loading">

  <div class="app-container">

    <div class="panel panel-controls">
      <h2>Student Details & Capture</h2>
      <div class="camera-wrap">
        <video id="video" autoplay playsinline></video>
        <canvas id="camCanvas" class="preview"></canvas>
        <div class="controls-grid">
          <button id="btnStart" class="btn btn-ghost">Start Camera</button>
          <button id="btnFlip" class="btn btn-ghost">Flip</button>
          <button id="btnCapture" class="btn btn-primary">Capture</button>
          <button id="btnClear" class="btn btn-ghost">Clear</button>
        </div>
        <div class="small" style="margin-top:8px;">Capture a square photo for best results.</div>
      </div>

      <div class="form-group">
        <label for="name">Student Name</label>
        <input id="name" type="text" placeholder="e.g. Ali Khan" />
      </div>

      <div class="form-group">
        <label for="class">Class</label>
        <input id="class" type="text" value="" placeholder="e.g. Nursery" />
      </div>

      <div class="form-group">
        <label for="age">Age (years)</label>
        <input id="age" type="number" min="3" max="20" value="10" />
      </div>
      
      <div class="form-group">
        <label for="height">Height (cm)</label>
        <input id="height" type="number" min="30" max="250" value="150" />
      </div>

      <div class="form-group">
        <label for="weight">Weight (kg)</label>
        <input id="weight" type="number" min="2" max="300" value="50" />
      </div>

      <div class="button-group">
        <button id="calcBtn" class="btn btn-primary">Calculate BMI</button>
        <button id="downloadBtn" class="btn btn-ghost">Download Card (PNG)</button>
      </div>

      
</div>

    <div class="panel panel-preview" id="cardArea">
        
        <div class="final-card-output" id="outputCard"> 
          <header class="card-header">
            <div class="logo-slot" id="logoSlot">QIEB</div>
            <div class="school-text">
              <div class="school-name">QUANTUM INSTITUTE OF EDUCATION BATTAGRAM</div>
              <div class="school-sub">Contact: <strong>03038929177</strong> • Address: <strong>Main KKH Battagram</strong></div>
            </div>
          </header>

          <main class="card-body">
            <div class="card-photo">
              <div class="photo-wrap" id="photoWrap">
                <div id="photoPlaceholder">PHOTO</div>
              </div>
            </div>

            <div class="card-info">
              <div class="info-grid">
                <span class="label">Name:</span> <span class="value" id="showName">--</span>
                <span class="label">Age:</span> <span class="value"id="showAge">-- years</span> 
                <span class="label">Height:</span> <span class="value" id="showHeight">-- cm</span>
                <span class="label">Weight:</span> <span class="value" id="showWeight">-- kg</span>
                <span class="label">Class:</span> <span class="value" id="showClass" >--</span>
              </div>

              <div class="card-result">
                <div style="display:flex; justify-content:space-between; align-items:flex-end">
                  <div>
                    <div class="bmi-large" id="bmiValue">--</div>
                    <div class="bmi-status" id="bmiStatus">BMI</div>
                  </div>
                  <div style="text-align:right;">
                    <div>BMI Week • QIEB</div>
                    <div>AUTO CALCULATION</div>
                  </div>
                </div>
              </div>
              
              <div class="card-advice" id="adviceArea">
                <strong>Advice:</strong> Enter data and click 'Calculate'.
              </div>
            </div>
          </main>
          
          <div class="bmic-bar">
            BMI WEEK | CALCULATED BY: QIEB - BMI CALCULATOR |
            <span id="todayDate"></span>
          </div>

          <footer class="card-footer">
            <strong>THIS BMI CARD IS FOR GENERAL SCREENING PURPOSES.</strong>
          </footer>
        </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- 1. Element References ---
    const elements = {
      video: document.getElementById('video'),
      camCanvas: document.getElementById('camCanvas'),
      btnStart: document.getElementById('btnStart'),
      btnCapture: document.getElementById('btnCapture'),
      btnFlip: document.getElementById('btnFlip'),
      btnClear: document.getElementById('btnClear'),
      nameInput: document.getElementById('name'),
      classInput: document.getElementById('class'),
      ageInput: document.getElementById('age'),
      heightInput: document.getElementById('height'),
      weightInput: document.getElementById('weight'),
      calcBtn: document.getElementById('calcBtn'),
      downloadBtn: document.getElementById('downloadBtn'),
      showName: document.getElementById('showName'),
      showClass: document.getElementById('showClass'),
      showAge: document.getElementById('showAge'),
      showHeight: document.getElementById('showHeight'),
      showWeight: document.getElementById('showWeight'),
      bmiValue: document.getElementById('bmiValue'),
      bmiStatus: document.getElementById('bmiStatus'),
      adviceArea: document.getElementById('adviceArea'),
      photoWrap: document.getElementById('photoWrap'),
      photoPlaceholder: document.getElementById('photoPlaceholder'),
      logoSlot: document.getElementById('logoSlot'),
      cardArea: document.getElementById('cardArea'),
      outputCard: document.getElementById('outputCard'), 
      body: document.body
    };

    let stream = null;
    let usingFront = true;
    let capturedDataUrl = null; 
    let logoImage = null; 

    // --- 2. Base64 Logo Placeholder ---
    const base64Logo = ''; 
    if (base64Logo) {
      loadLogoFromDataURL(base64Logo);
    }
    // --- End Base64 Logo Placeholder ---


    // --- CRITICAL: Function to handle scaling the fixed card for preview ---
    function scaleCardForPreview() {
        const cardContainerWidth = elements.cardArea.offsetWidth;
        const fixedCardWidth = elements.outputCard.offsetWidth; // 600px
        
        // Calculate the scale factor needed to fit the 600px card into the responsive container
        const scale = cardContainerWidth / fixedCardWidth;
        
        // Apply the scale transformation, translating it to center it perfectly
        elements.outputCard.style.transform = `scale(${scale})`;
        
        // Adjust the height of the parent container to match the scaled height of the child, plus a small margin
        elements.cardArea.style.height = `${fixedCardWidth * scale}px`;
    }
    
    // Attach scaling to window resize event
    window.addEventListener('resize', scaleCardForPreview);

    // --- 3. Core Functions ---
    
    function calculateBMI(weightKg, heightCm, ageYears) {
      if (!weightKg || !heightCm) {
        return { bmi: null, status: 'Missing Data', advice: 'Please enter height and weight.' };
      }
      
      const heightM = heightCm / 100;
      const bmi = weightKg / (heightM * heightM);
      const roundedBMI = bmi.toFixed(1);
      
      let status = 'Not Calculated';
      let advice = 'No specific advice yet.';

      if (ageYears < 18) {
        if (bmi < 15) {
          status = 'Severely Underweight';
          advice = 'Consult a doctor. Focus on a nutrient-rich, higher-calorie diet.';
        } else if (bmi >= 15 && bmi < 18.5) {
          status = 'Underweight';
          advice = 'Encourage healthy eating habits and regular, moderate activity.';
        } else if (bmi >= 18.5 && bmi < 25) {
          status = 'Healthy Weight';
          advice = 'Maintain a balanced diet and regular physical activity.';
        } else if (bmi >= 25 && bmi < 30) {
          status = 'Overweight';
          advice = 'Encourage increased physical activity and limit sugary snacks.';
        } else if (bmi >= 30) {
          status = 'Obese';
          advice = 'Consult a doctor. Focus on balanced meals and active play time.';
        }
      } else { 
        if (bmi < 18.5) {
          status = 'Underweight';
          advice = 'Focus on increasing muscle mass with protein and healthy fats.';
        } else if (bmi >= 18.5 && bmi < 25) {
          status = 'Normal'; 
          advice = 'Good — keep balanced diet & playtime.'; 
        } else if (bmi >= 25 && bmi < 30) {
          status = 'Overweight';
          advice = 'Incorporate more cardio and reduce processed food intake.';
        } else if (bmi >= 30) {
          status = 'Obese';
          advice = 'Consult a doctor for a comprehensive health plan.';
        }
      }

      return { bmi: roundedBMI, status, advice };
    }

    function updateCard() {
      const name = elements.nameInput.value || '--';
      const studentClass = elements.classInput.value || '--'; 
      const age = elements.ageInput.value; 
      const height = elements.heightInput.value;
      const weight = elements.weightInput.value;

      elements.showName.textContent = name;
      elements.showClass.textContent = studentClass;
      elements.showAge.textContent = age ? `${age} years` : '-- years'; 
      elements.showHeight.textContent = height ? `${height} cm` : '-- cm';
      elements.showWeight.textContent = weight ? `${weight} kg` : '-- kg';
      
      const result = calculateBMI(parseFloat(weight), parseFloat(height), parseInt(age));
      
      elements.bmiValue.textContent = result.bmi || '--';
      elements.bmiStatus.textContent = result.status;
      elements.adviceArea.innerHTML = `<strong>Advice:</strong> ${result.advice}`;
    }

    // Camera and Photo functions (simplified)
    async function startCamera(frontFacing = true) { 
        if (stream) stream.getTracks().forEach(track => track.stop());
        try {
            const constraints = { video: { width: { ideal: 640 }, height: { ideal: 480 }, facingMode: frontFacing ? 'user' : 'environment' } };
            stream = await navigator.mediaDevices.getUserMedia(constraints);
            elements.video.srcObject = stream;
            elements.video.style.display = 'block';
            elements.camCanvas.style.display = 'none';
            elements.btnStart.textContent = 'Stop Camera';
            elements.btnFlip.disabled = false;
            elements.btnCapture.disabled = false;
            elements.btnClear.disabled = true;
        } catch (err) {
            alert('Could not start camera.');
            elements.btnStart.textContent = 'Start Camera';
        }
    }
    function stopCamera() { 
        if (stream) { stream.getTracks().forEach(track => track.stop()); stream = null; }
        elements.video.style.display = 'none';
        elements.btnStart.textContent = 'Start Camera';
        elements.btnFlip.disabled = true;
        elements.btnCapture.disabled = true;
    }
    function capturePhoto() { 
        const video = elements.video;
        const canvas = elements.camCanvas;
        const context = canvas.getContext('2d');
        const targetSize = elements.photoWrap.offsetWidth;
        canvas.width = targetSize;
        canvas.height = targetSize;
        const size = Math.min(video.videoWidth, video.videoHeight);
        const x = (video.videoWidth - size) / 2;
        const y = (video.videoHeight - size) / 2;
        context.drawImage(video, x, y, size, size, 0, 0, targetSize, targetSize);
        capturedDataUrl = canvas.toDataURL('image/png');
        elements.photoWrap.style.backgroundImage = `url('${capturedDataUrl}')`;
        elements.photoWrap.style.backgroundSize = 'cover';
        elements.photoPlaceholder.style.display = 'none';
        stopCamera();
        elements.camCanvas.style.display = 'block'; 
        elements.btnClear.disabled = false;
    }
    function clearPhoto() {
      capturedDataUrl = null;
      elements.photoWrap.style.backgroundImage = 'none';
      elements.photoPlaceholder.style.display = 'block';
      elements.btnClear.disabled = true;
      elements.camCanvas.style.display = 'none';
    }
    
    function loadLogoFromDataURL(dataURL) { 
        const img = document.createElement('img');
        img.src = dataURL;
        img.onload = () => {
            logoImage = img;
            elements.logoSlot.innerHTML = ''; 
            elements.logoSlot.appendChild(img);
        };
        img.onerror = () => { elements.logoSlot.innerHTML = 'QIEB'; };
    }

    // --- 4. Event Listeners ---
    
    elements.nameInput.addEventListener('input', updateCard);
    elements.classInput.addEventListener('input', updateCard);
    elements.ageInput.addEventListener('input', updateCard);
    elements.heightInput.addEventListener('input', updateCard);
    elements.weightInput.addEventListener('input', updateCard);
    elements.calcBtn.addEventListener('click', updateCard);

    elements.btnStart.addEventListener('click', () => { if (stream) stopCamera(); else startCamera(usingFront); });
    elements.btnFlip.addEventListener('click', () => { usingFront = !usingFront; startCamera(usingFront); });
    elements.btnCapture.addEventListener('click', capturePhoto);
    elements.btnClear.addEventListener('click', clearPhoto);
    
    // --- Download Card (html2canvas) ---
    elements.downloadBtn.addEventListener('click', () => {
      elements.downloadBtn.disabled = true;
      elements.downloadBtn.textContent = 'Generating...';

      const fixedCardWidth = elements.outputCard.offsetWidth;
      const TARGET_SCALE = 4.0; 
      
      // Temporarily remove the preview scaling for accurate capture
      elements.outputCard.style.transform = 'none';
      elements.cardArea.style.height = `${fixedCardWidth}px`; 

      html2canvas(elements.outputCard, {
          scale: TARGET_SCALE, 
          useCORS: true,
          logging: false 
      }).then(canvas => {
          // Restore preview scaling after capture
          scaleCardForPreview(); 

          const name = elements.nameInput.value || 'BMI_Card';
          const link = document.createElement('a');
          link.download = `${name.replace(/\s/g, '_')}_BMI_Card.png`;
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          elements.downloadBtn.disabled = false;
          elements.downloadBtn.textContent = 'Download Card (PNG)';
      }).catch(error => {
          console.error('Error generating card:', error);
          alert('Failed to generate card. Ensure all data and images are loaded.');
          // Restore preview scaling even on error
          scaleCardForPreview(); 
          elements.downloadBtn.disabled = false;
          elements.downloadBtn.textContent = 'Download Card (PNG)';
      });
    });

    // --- 5. Initialization ---
    function init() {
      const options = { day: 'numeric', month: 'short', year: 'numeric' };
      document.getElementById('todayDate').textContent = new Date().toLocaleDateString('en-US', options).toUpperCase();
      
      updateCard();

      // IMPORTANT: Initial scaling to fit the card on the screen
      scaleCardForPreview();
      
      elements.body.classList.remove('app-loading');
      elements.btnFlip.disabled = true;
      elements.btnCapture.disabled = true;
      elements.btnClear.disabled = true;

      clearPhoto(); 
    }

    init();
});
</script>

    </div>
  </div>
</body>
</html>
